<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

    <h1>Hello World!</h1>
    <p>Welcome to my first Django project!</p>

    <p>Back to <a href="/testCardCheck">Members</a></p>

    <p>https://www.w3schools.com/django/django_master_template.php</p>
    <button type="button" class="btn btn-primary" id="VideoCapture">Video Plot</button>

    <!-- Image container to display the captured image -->
    <div id="imageContainer"></div>

    <!-- ‡∏õ‡∏∏‡πà‡∏° test ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö testCardCheck ‡πÉ‡∏ô views.py -->
    <button type="button" class="btn btn-primary" id="testButton">Test Card Check</button>

    <br>
    <br>
    
    <form id="pdfUploadForm" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="pdf_file" accept=".pdf" id="pdfFileInput">
        <button type="button" class="btn btn-warning" id="pdfUploadButton">Upload PDF</button>
    </form>

    <div id="imageContainer"></div>
    
    
    <!-- <button type="button" class="btn btn-warning" id="testButton">Upload File</button> -->

    <script>
        //? $ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏≠‡∏á jQuery ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ JavaScript ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ DOM

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ HTML ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        $(document).ready(function() {
            console.log("‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ Homepage.html üì¶üì¶");
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° VideoCapture ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
            $("#VideoCapture").click(function() {
                // ‡∏ó‡∏≥ AJAX request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á URL /VideoCapture/
                $.ajax({
                    url: "/VideoCapture/",
                    type: "GET",
                    dataType: "json",  // Specify that you expect a JSON response
                    success: function(response) {
                        console.log(response);
                        // Access the base64 string from the JSON response
                        var frameBase64 = response.frame_base64;

                        // Create an image element and set its source to the base64 string
                        var imgElement = $("<img>"); // ‡∏™‡∏£‡πâ‡∏≤‡∏á element <img> ‡πÉ‡∏´‡∏°‡πà , ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà $ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô jQuery(document.createElement("img"))
                        imgElement.attr("src", "data:image/jpeg;base64," + frameBase64);

                        // Append the image element to the image container
                        $("#imageContainer").empty().append(imgElement); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô element ‡∏ó‡∏µ‡πà‡∏°‡∏µ id ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö "imageContainer" ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥ <img> element ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏°‡∏≤‡πÉ‡∏™‡πà.
                    },
                    error: function(error) {
                        console.log("Error:", error);
                    }
                });
            });

            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° testButton ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
            $("#testButton").click(function() {
                // ‡∏ó‡∏≥ AJAX request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á URL /testCardCheck/
                $.ajax({
                    url: "/testCardCheck/",
                    type: "GET",
                    success: function(response) {
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å server
                        alert(response);
                    },
                    error: function(error) {
                        console.log("Error:", error);
                    }
                });
            });


            //  ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ path‡∏Ñ‡∏∑‡∏≠ /upload_and_convert_pdf/ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ id="#pdfUploadButton"
            $("#pdfUploadButton").click(function() {
            var formData = new FormData($("#pdfUploadForm")[0]); //  ‡∏°‡∏≤‡∏à‡∏≤‡∏Å id="pdfUploadForm"
                $.ajax({
                    url: "/upload_and_convert_pdf/",
                    type: "POST",
                    data: formData, //  ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏Å‡∏±‡∏ö request 
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        console.log(response); 
                        // ‡∏ù‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ --> return JsonResponse({'png_path': fs.url('output.png')})
                        // alert("PDF uploaded and converted successfully! PNG saved at " + response.png_path);
                        if (response.png_url) { // ‡πÑ‡∏î‡πâ  png_url: "/media/output.png"
                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û
                            var imgElement = $("<img>");
                            imgElement.attr("src", response.png_url);

                            // ‡πÅ‡∏ó‡∏£‡∏Å‡∏†‡∏≤‡∏û‡∏•‡∏á‡πÉ‡∏ô container
                            $("#imageContainer").empty().append(imgElement);

                            // ‡πÅ‡∏™‡∏î‡∏á alert ‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                            alert("PDF uploaded and converted successfully! PNG saved at " + response.png_url);
                        } else {
                            // ‡∏Å‡∏£‡∏ì‡∏µ error
                            alert("Error: " + response.error);
                        }

                    },
                    error: function(error) {
                        console.log("Error:", error);
                    }
                });
            });


        });
    </script>
</body>
</html>
