<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

    <h1>Hello World!</h1>
    <p>Welcome to my first Django project!</p>

    <p>Back to <a href="/testCardCheck">Members</a></p>

    <p>https://www.w3schools.com/django/django_master_template.php</p>
    <button type="button" class="btn btn-primary" id="VideoCapture">Video Plot</button>

    <!-- Image container to display the captured image -->
    <div id="video_imageContainer"></div>

    <br>

    <!-- ‡∏õ‡∏∏‡πà‡∏° test ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö testCardCheck ‡πÉ‡∏ô views.py -->
    <button type="button" class="btn btn-primary" id="testButton">Test Card Check</button>

    <br>
    <br>
    
    <form id="pdfUploadForm" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- ‡∏ï‡∏±‡∏ß token ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á security,  When the form is submitted, Django checks the CSRF token to ensure it matches the expected value. This helps prevent CSRF attacks. -->
        <!-- ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ ‡∏Ñ‡∏•‡∏¥‡πä‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ => https://docs.djangoproject.com/en/5.0/ref/csrf/ -->
        <input type="file" name="pdf_file" accept=".pdf" id="pdfFileInput">
        <button type="button" class="btn btn-warning" id="pdfUploadButton">Upload PDF</button>
    </form>

    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û pdf ‡∏ó‡∏µ‡πà upload ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ -->
    <div id="pdfUploadContainer"></div>
    

    <br>
    <br>


    <form id="imageUploadForm" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="file" name="image_file" accept="image/*" id="imageFileInput">
        <button type="button" class="btn btn-success" id="imageUploadButton">Upload Image</button>
    </form>
    
    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û ‡∏ó‡∏µ‡πà upload ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ -->
    <div id="imageUploadContainer"></div>
    

    <br>
    <br>

    <button type="button" class="btn btn-dark" id="createImageTable">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
   

    <script>
        //? $ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏≠‡∏á jQuery ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ JavaScript ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ DOM

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ HTML ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        $(document).ready(function() {
            console.log("‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ Homepage.html üì¶üì¶");
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° VideoCapture ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
            $("#createImageTable").click(function() {
                console.log("alert(response);");
                $.ajax({
                    url: "/createImageTable/",
                    type: "GET",
                    success: function(response){
                        console.log(response);

                        // Access the PDF link and image links from the JSON response
                        var pdfLink = response.pdf_link;
                        var imageLinks = response.image_links;

                        // Display the PDF link
                        var pdfLinkElement = $("<p>").html("Download PDF: <a href='" + pdfLink + "' download>PDF Link</a>");
                        $("#pdfUploadContainer").empty().append(pdfLinkElement);

                        // Display the image links
                        var imageLinksList = $("<ul>");
                        for (var i = 0; i < imageLinks.length; i++) {
                            var listItem = $("<li>").html("Download Image " + (i + 1) + ": <a href='" + imageLinks[i] + "' download>Image " + (i + 1) + " Link</a>");
                            imageLinksList.append(listItem);
                        }
                        $("#pdfUploadContainer").append(imageLinksList);
                    },
                    error: function(error){
                        console.log("Error:", error);
                    }
                });
            });
            $("#VideoCapture").click(function() {
                // ‡∏ó‡∏≥ AJAX request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á URL /VideoCapture/
                $.ajax({
                    url: "/VideoCapture/",
                    type: "GET",
                    dataType: "json",  // Specify that you expect a JSON response
                    success: function(response) {
                        console.log(response);
                        // Access the base64 string from the JSON response
                        var frameBase64 = response.frame_base64;

                        // Create an image element and set its source to the base64 string
                        var imgElement = $("<img>"); // ‡∏™‡∏£‡πâ‡∏≤‡∏á element <img> ‡πÉ‡∏´‡∏°‡πà , ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà $ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô jQuery(document.createElement("img"))
                        imgElement.attr("src", "data:image/jpeg;base64," + frameBase64);

                        // Append the image element to the image container
                        $("#video_imageContainer").empty().append(imgElement); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô element ‡∏ó‡∏µ‡πà‡∏°‡∏µ id ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö "imageContainer" ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥ <img> element ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏°‡∏≤‡πÉ‡∏™‡πà.
                    },
                    error: function(error) {
                        console.log("Error:", error);
                    }
                });
            });

            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏° testButton ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å
            $("#testButton").click(function() {
                // ‡∏ó‡∏≥ AJAX request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á URL /testCardCheck/
                $.ajax({
                    url: "/testCardCheck/",
                    type: "GET",
                    success: function(response) {
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å server
                        alert(response);
                    },
                    error: function(error) {
                        console.log("Error:", error);
                    }
                });
            });


            //  ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ path‡∏Ñ‡∏∑‡∏≠ /upload_and_convert_pdf/ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ id="#pdfUploadButton"
            $("#pdfUploadButton").click(function() {
                var formData = new FormData($("#pdfUploadForm")[0]); //  ‡∏°‡∏≤‡∏à‡∏≤‡∏Å id="pdfUploadForm"
                $.ajax({
                    url: "/upload_and_convert_pdf/",
                    type: "POST",
                    data: formData, //  ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏Å‡∏±‡∏ö request 
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        console.log(response); 
                        // ‡∏ù‡∏±‡πà‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô ‡∏™‡πà‡∏á‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ --> return JsonResponse({'png_path': fs.url('output.png')})
                        // alert("PDF uploaded and converted successfully! PNG saved at " + response.png_path);
                        if (response.page_png_path_url) { // ‡πÑ‡∏î‡πâ  png_url: "/media/output.png"
                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û

                            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå container ‡πÄ‡∏Å‡πà‡∏≤
                            $("#pdfUploadContainer").empty();

                            // ‡∏•‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å URL ‡πÉ‡∏ô array
                            for (var i = 0; i < response.page_png_path_url.length; i++) {
                                // ‡∏™‡∏£‡πâ‡∏≤‡∏á element <img> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ URL
                                var imgElement = $("<img>");
                                imgElement.attr("src", response.page_png_path_url[i]);

                                // ‡πÅ‡∏ó‡∏£‡∏Å‡∏†‡∏≤‡∏û‡∏•‡∏á‡πÉ‡∏ô container
                                $("#pdfUploadContainer").append(imgElement);
                            }
                            

                            // ‡πÅ‡∏™‡∏î‡∏á alert ‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                            alert("PDF uploaded and converted successfully! PNG saved at " + response.png_url);
                        } else {
                            // ‡∏Å‡∏£‡∏ì‡∏µ error
                            alert("Error: " + response.error);
                        }

                    },
                    error: function(error) {
                        console.log("Error:", error);
                    }
                });
            });
            

            $("#imageUploadButton").click(function() {
                var formData = new FormData($("#imageUploadForm")[0]);
                $.ajax({
                    url: "/upload_image/",
                    type: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        // Handle the success response
                        console.log(response);
                        if (response.saveImage_url) { // ‡πÑ‡∏î‡πâ  png_url: "/media/output.png"
                            // ‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û
                            var imgElement = $("<img>");
                            imgElement.attr("src", response.saveImage_url);
                            imgElement.css({
                                'width': '300px',
                                'height': '200px'
                            });

                            // ‡πÅ‡∏ó‡∏£‡∏Å‡∏†‡∏≤‡∏û‡∏•‡∏á‡πÉ‡∏ô container
                            $("#imageUploadContainer").empty().append(imgElement);

                            // ‡πÅ‡∏™‡∏î‡∏á alert ‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                            alert("successfully! Image " + response.png_url);
                        } 
                        else {
                            // ‡∏Å‡∏£‡∏ì‡∏µ error
                            alert("Error: " + response.error);
                        }
                        if (response.firstName) {
                            let yourname = " ‡∏ä‡∏∑‡πà‡∏≠ : " + response.firstName + " ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• : " +response.surName;
                            var divElement = $("<div>").text(yourname);
                            $("#imageUploadContainer").append(divElement);
                        }
                        if (response.newPhoto) {
                            var divElement_newPhoto = $("<div>").text("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ ‡∏ä‡πà‡∏ß‡∏¢‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏∞");
                            $("#imageUploadContainer").append(divElement_newPhoto);
                        }
                        if (response.errorPDF) {
                            var divElement_loadPDF = $("<div>").text("*‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î PDF ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∞ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏∞");
                            divElement_loadPDF.css({
                                "color": "red"
                            })
                            $("#imageUploadContainer").empty().append(divElement_loadPDF);
                        }
                    },
                    error: function(error) {
                        // Handle the error response
                        console.log("Error:", error);
                        // ‡∏Å‡∏£‡∏ì‡∏µ error ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ AJAX request
                        var pdfLinkElement = $("<p>").html("*‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞");
                        pdfLinkElement.css({
                            "color": "red"
                        })
                        $("#imageUploadContainer").empty().append(pdfLinkElement);
                    }
                });
            });


        });
    </script>
</body>
</html>
